"use strict";(self.webpackChunkopen_metadata=self.webpackChunkopen_metadata||[]).push([[1794],{82913:function(e,t,n){n.d(t,{Z:function(){return z}});var a=n(70655),l=n(12028),r=n(71577),s=n(94184),d=n.n(s),i=n(96486),o=n(67294),c=n(52046),m=n(13950),u=n(58369),p=n(20615),v=n(14469),f=n(31615),E=n(51887),h=n(6929),w=n(31982),T=n(50168),y=n(28178),C=n(53867),g=n(27300),N=n(92265),k=n(77740),b=n(16583),Z=function(e){var t,n,l,r=e.className,s=e.selectedThread,d=e.postFeed,i=e.onConfirmation,c=e.updateThreadHandler,u=(0,a.CR)((0,o.useState)(s),2),p=u[0],v=u[1],E=null!==(n=null===(t=null==p?void 0:p.posts)||void 0===t?void 0:t.length)&&void 0!==n?n:0,y={message:p.message,from:p.createdBy,postTs:p.threadTs,id:p.id,reactions:p.reactions};return(0,o.useEffect)((function(){(0,m.h4)(s.id).then((function(e){v(e.data)})).catch((function(e){(0,T.Eo)(e,h.Z["api-error-messages"]["fetch-feed-error"])}))}),[s]),o.createElement(o.Fragment,null,o.createElement("div",{className:r},p?o.createElement("div",{"data-testid":"main-message"},o.createElement(b.Z,{isEntityFeed:!0,isThread:!0,announcementDetails:p.announcement,className:"tw-mb-3",feed:y,feedType:p.type||f.Th.Conversation,threadId:p.id,updateThreadHandler:c,onConfirmation:i})):null,E>0?o.createElement("div",{"data-testid":"replies"},o.createElement("div",{className:"tw-mb-3 tw-flex"},o.createElement("span",{"data-testid":"replies-count"},(0,w.l9)(E,"reply","replies")),o.createElement("span",{className:"tw-flex-auto tw-self-center tw-ml-1.5"},o.createElement("hr",null))),null===(l=null==p?void 0:p.posts)||void 0===l?void 0:l.map((function(e,t){return o.createElement(b.Z,{isEntityFeed:!0,className:"tw-mb-3",feed:e,feedType:p.type||f.Th.Conversation,key:t,threadId:p.id,updateThreadHandler:c,onConfirmation:i})}))):null),o.createElement(g.Z,{buttonClass:"tw-mr-4",className:"tw-ml-5 tw-mr-2 tw-my-6",onSave:d}))},S=n(91894),F=n(59293),R=n(44355),I=n(77863),x=n(46892),H=n(18085),B=n(14177),q=n(53552),D=n(53179),A=function(e){var t=e.className,n=e.threads,l=e.selectedThreadId,r=e.postFeed,s=e.onThreadIdSelect,d=e.onThreadSelect,c=e.onConfirmation,m=e.updateThreadHandler,p=(0,F.k6)(),v=(0,w.wq)(n),E=v.updatedFeedList,h=v.relativeDays;return o.createElement("div",{className:t},h.map((function(e,t){return o.createElement("div",{"data-testid":"thread"+t,key:t},o.createElement(B.Z,{className:"tw-relative tw-mt-1 tw-mb-3.5",relativeDay:e}),E.filter((function(t){return t.relativeDay===e})).map((function(e,t){var n,v,E,h={message:e.message,postTs:e.threadTs,from:e.createdBy,id:e.id,reactions:e.reactions},w=(0,i.isEqual)(e.type,f.Th.Task),T=e.type===f.Th.Announcement,y=(null===(n=null==e?void 0:e.posts)||void 0===n?void 0:n.length)||0,C=e.postsCount?e.postsCount-1:0,N=(0,a.ev)([],(0,a.CR)(new Set(((null==e?void 0:e.posts)||[]).map((function(e){return e.from}))))).slice(0,y>=3?2:1),k=null===(v=null==e?void 0:e.posts)||void 0===v?void 0:v[y-1];return o.createElement(o.Fragment,{key:t},o.createElement(S.Z,{className:"ant-card-feed",key:t+" - card",style:(0,a.pi)((0,a.pi)({},x.K),{marginTop:"20px",paddingTop:w?"8px":"",border:w?"1px solid "+u.Rw:T?"1px solid "+u.WB:x.K.border,background:T?""+u.pA:""}),onClick:function(){return e.task&&function(e,t){t&&p.push((0,R.yv)(String(e)))}(e.task.id,w)}},w&&o.createElement(D.Z,{status:null===(E=e.task)||void 0===E?void 0:E.status}),T&&o.createElement(q.Z,null),o.createElement("div",{"data-testid":"main-message"},o.createElement(b.Z,{isEntityFeed:!0,isThread:!0,announcementDetails:e.announcement,entityLink:e.about,feed:h,feedType:e.type||f.Th.Conversation,taskDetails:e.task,threadId:e.id,updateThreadHandler:m,onConfirmation:c,onReply:function(){return d(e.id)}})),y>0?o.createElement("div",{"data-testid":"replies-container"},y>1?o.createElement("div",{className:"tw-ml-9 tw-my-2"},Boolean(k)&&o.createElement("div",{className:"tw-filter-seperator"}),o.createElement("div",{className:"tw-flex tw-my-4"},o.createElement(H.Z,{isFooterVisible:!0,lastReplyTimeStamp:null==k?void 0:k.postTs,repliedUsers:N,replies:C,threadId:e.id,onThreadSelect:function(){return d(e.id)}}))):null,o.createElement("div",{"data-testid":"latest-reply"},o.createElement(b.Z,{isEntityFeed:!0,className:"tw-ml-9",feed:k,feedType:e.type||f.Th.Conversation,threadId:e.id,updateThreadHandler:m,onConfirmation:c,onReply:function(){return t=e.id,void s(l===t?"":t);var t}}))):null,l===e.id?o.createElement("div",{"data-testid":"quick-reply-editor"},o.createElement(g.Z,{buttonClass:"tw-mr-4",className:"tw-ml-5 tw-mr-2 tw-mb-6",onSave:r})):null,e.task&&o.createElement("div",{className:"tw-border-t tw-border-main tw-py-1"},o.createElement("span",{className:"tw-text-grey-muted"},"Assignees:"," "),o.createElement(I.Z,{assignees:e.task.assignees||[],className:"tw-ml-0.5 tw-align-baseline tw-inline-flex tw-flex-wrap"}))))})))})))},L=n(56256),U=n(27049),K=n(71859),O=function(e){var t=e.threads,n=e.className,l=e.selectedThreadId,r=e.onThreadIdSelect,s=e.onThreadSelect,d=e.onConfirmation,i=e.postFeed,c=e.updateThreadHandler,m=(0,w.wq)(t).updatedFeedList,p=m.filter((function(e){var t,n;return e.announcement&&(0,K.B7)(null===(t=e.announcement)||void 0===t?void 0:t.startTime,null===(n=e.announcement)||void 0===n?void 0:n.endTime)})),v=m.filter((function(e){var t,n;return!(e.announcement&&(0,K.B7)(null===(t=e.announcement)||void 0===t?void 0:t.startTime,null===(n=e.announcement)||void 0===n?void 0:n.endTime))})),E=function(e){return e.map((function(e,t){var n,m,p={message:e.message,postTs:e.threadTs,from:e.createdBy,id:e.id,reactions:e.reactions},v=(null===(n=null==e?void 0:e.posts)||void 0===n?void 0:n.length)||0,E=e.postsCount?e.postsCount-1:0,h=(0,a.ev)([],(0,a.CR)(new Set(((null==e?void 0:e.posts)||[]).map((function(e){return e.from}))))).slice(0,v>=3?2:1),w=null===(m=null==e?void 0:e.posts)||void 0===m?void 0:m[v-1];return o.createElement(o.Fragment,{key:t},o.createElement(S.Z,{className:"ant-card-feed","data-testid":"announcement-card",key:t+" - card",style:(0,a.pi)((0,a.pi)({},x.K),{marginTop:"20px",paddingTop:"8px",border:"1px solid "+u.WB,background:""+u.pA})},o.createElement(q.Z,null),o.createElement("div",{"data-testid":"main-message"},o.createElement(b.Z,{isEntityFeed:!0,isThread:!0,announcementDetails:e.announcement,entityLink:e.about,feed:p,feedType:e.type||f.Th.Conversation,taskDetails:e.task,threadId:e.id,updateThreadHandler:c,onConfirmation:d,onReply:function(){return s(e.id)}})),v>0?o.createElement("div",{"data-testid":"replies-container"},v>1?o.createElement("div",{className:"tw-ml-9 tw-my-2"},Boolean(w)&&o.createElement("div",{className:"tw-filter-seperator"}),o.createElement("div",{className:"tw-flex tw-my-4"},o.createElement(H.Z,{isFooterVisible:!0,lastReplyTimeStamp:null==w?void 0:w.postTs,repliedUsers:h,replies:E,threadId:e.id,onThreadSelect:function(){return s(e.id)}}))):null,o.createElement("div",{"data-testid":"latest-reply"},o.createElement(b.Z,{isEntityFeed:!0,className:"tw-ml-9",feed:w,feedType:e.type||f.Th.Conversation,threadId:e.id,updateThreadHandler:c,onConfirmation:d,onReply:function(){return t=e.id,void r(l===t?"":t);var t}}))):null,l===e.id?o.createElement("div",{"data-testid":"quick-reply-editor"},o.createElement(g.Z,{buttonClass:"tw-mr-4",className:"tw-ml-5 tw-mr-2 tw-mb-6",onSave:i})):null))}))};return o.createElement("div",{className:n},E(p),Boolean(v.length)&&o.createElement(o.Fragment,null,o.createElement(L.Z.Text,{className:"tw-block tw-mt-4 tw-font-medium","data-testid":"inActive-announcements"},"Inactive Announcements"),o.createElement(U.Z,{className:"tw-mb-4 tw-mt-2"})),E(v))},z=function(e){var t=e.threadLink,n=e.onCancel,s=e.postFeedHandler,b=e.createThread,S=e.deletePostHandler,F=e.updateThreadHandler,R=e.className,I=e.showHeader,x=void 0===I||I,H=e.threadType,B=(0,a.CR)((0,o.useState)([]),2),q=B[0],D=B[1],L=(0,a.CR)((0,o.useState)(),2),U=L[0],K=L[1],z=(0,a.CR)((0,o.useState)(""),2),V=z[0],W=z[1],_=(0,a.CR)((0,o.useState)(!1),2),j=_[0],G=_[1],M=(0,a.CR)((0,o.useState)(u.BB),2),P=M[0],X=M[1],Y=(0,a.CR)((0,E.M)(p.a),2),J=Y[0],Q=Y[1],$=(0,a.CR)((0,o.useState)({}),2),ee=$[0],te=$[1],ne=(0,a.CR)((0,o.useState)(!1),2),ae=ne[0],le=ne[1],re=(0,a.CR)((0,o.useState)(f.aq.Open),2),se=re[0],de=re[1],ie=(0,i.isEqual)(H,f.Th.Task),oe=(0,i.isEqual)(H,f.Th.Conversation),ce=(0,i.isEqual)(se,f.aq.Closed),me=H===f.Th.Announcement,ue=function(e){var n=ie?se:void 0;le(!0),(0,m.XG)(t,e,H,v.D.ALL,n).then((function(t){var n=t.data,l=t.paging;D((function(t){return e?(0,a.ev)((0,a.ev)([],(0,a.CR)(t)),(0,a.CR)(n)):(0,a.ev)([],(0,a.CR)(n))})),te(l)})).catch((function(e){(0,T.Eo)(e,h.Z["api-error-messages"]["fetch-thread-error"])})).finally((function(){le(!1)}))},pe=function(){X(u.BB)},ve=function(){setTimeout((function(){ue()}),500)},fe=function(e){X(e)},Ee=(0,w.dS)(t),he=function(e){var t;null==s||s(e,null!==(t=null==U?void 0:U.id)&&void 0!==t?t:V),ve()},we=function(e){W(e)},Te=function(e){var t=q.find((function(t){return t.id===e}));t&&K(t)},ye=function(e,t,n,a){F(e,t,n,a),ve()};return(0,o.useEffect)((function(){var e=function(e){"Escape"===e.key&&n&&n()};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[]),(0,o.useEffect)((function(){Te(null==U?void 0:U.id)}),[q]),(0,o.useEffect)((function(){ue()}),[t,H,se]),(0,o.useEffect)((function(){var e,t;e=ee,t=ae,Q&&(null==e?void 0:e.after)&&!t&&ue(e.after)}),[ee,ae,Q]),o.createElement(o.Fragment,null,o.createElement("div",{id:"thread-panel-body"},x&&oe&&o.createElement(N.Z,{className:"tw-px-4 tw-shadow-sm",entityField:Ee,noun:oe?"Conversations":"Tasks",onCancel:function(){return n&&n()},onShowNewConversation:q.length>0&&(0,i.isUndefined)(U)?function(e){G(e)}:void 0}),ie&&o.createElement("div",{className:"tw-flex tw-justify-end tw-mr-2 tw-mt-2"},o.createElement(l.Z,{size:"small",onChange:function(e){de(e?f.aq.Closed:f.aq.Open)}}),o.createElement("span",{className:"tw-ml-1"},"Closed Tasks")),(0,i.isUndefined)(U)?o.createElement(o.Fragment,null,j||(0,i.isEqual)(q.length,0)?o.createElement(o.Fragment,null,oe&&o.createElement(o.Fragment,null,o.createElement("p",{className:"tw-ml-9 tw-mr-2 tw-mb-2 tw-mt-1"},"You are starting a new conversation"),o.createElement(g.Z,{buttonClass:"tw-mr-4",className:"tw-ml-5 tw-mr-2",placeHolder:"Enter a message",onSave:function(e){var n,a,l,r=null!==(a=null===(n=c.Z.userDetails)||void 0===n?void 0:n.name)&&void 0!==a?a:null===(l=c.Z.users[0])||void 0===l?void 0:l.name;b({message:e,from:r,about:t}),ve()}})),ie&&o.createElement(y.Z,null,o.createElement("p",null,ce?"No Closed Tasks":"No Open Tasks")),me&&o.createElement(y.Z,null,o.createElement("p",{"data-testid":"announcement-error"},"No Announcements, Click on add announcement to add one."))):null,me?o.createElement(O,{className:d()({"tw-p-4":!R},R),postFeed:he,selectedThreadId:V,threads:q,updateThreadHandler:ye,onConfirmation:fe,onThreadIdSelect:we,onThreadSelect:Te}):o.createElement(A,{className:d()({"tw-p-4":!R},R),postFeed:he,selectedThreadId:V,threads:q,updateThreadHandler:ye,onConfirmation:fe,onThreadIdSelect:we,onThreadSelect:Te}),o.createElement("div",{"data-testid":"observer-element",id:"observer-element",ref:J},ae?o.createElement(C.Z,null):null)):o.createElement(o.Fragment,null,o.createElement(r.Z,{className:"tw-mb-3 tw-ml-2",size:"small",type:"link",onClick:function(){K(void 0)}},"Back"),o.createElement(Z,{className:"tw-pb-4 tw-pl-5 tw-pr-2",postFeed:he,selectedThread:U,updateThreadHandler:ye,onConfirmation:fe}))),o.createElement(k.Z,{visible:P.state,onDelete:function(){P.postId&&P.threadId&&(null==S||S(P.threadId,P.postId,P.isThread)),pe(),ve()},onDiscard:pe}))}}}]);