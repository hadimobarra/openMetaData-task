"use strict";(self.webpackChunkopen_metadata=self.webpackChunkopen_metadata||[]).push([[6771],{6771:function(e,t,n){n.r(t);var i=n(70655),r=n(19650),o=n(96486),s=n(67294),a=n(59293),c=n(32822),l=n(22503),u=n(4318),f=n(28178),p=n(84419),g=n(74380),m=n(14109),d=n(53867),v=n(62761),w=n(96162),E=n(78666),C=n(31968),h=n(28517),S=n(5302),R=n(6929),y=n(48132),D=n(14731),Z=n(96840),I=n(35892),k=n(50168);t.default=function(){var e=(0,a.UO)(),t=e.ingestionFQN,n=e.ingestionType,P=e.serviceFQN,N=e.serviceCategory,T=(0,a.k6)(),b=(0,i.CR)((0,s.useState)(),2),L=b[0],A=b[1],O=(0,i.CR)((0,s.useState)({}),2),x=O[0],z=O[1],Q=(0,i.CR)((0,s.useState)(1),2),Y=Q[0],F=Q[1],G=(0,i.CR)((0,s.useState)(!0),2),H=G[0],U=G[1],_=(0,i.CR)((0,s.useState)(""),2),B=_[0],M=_[1],V=(0,i.CR)((0,s.useState)(0),2),W=V[0],q=V[1],J=(0,i.CR)((0,s.useState)(!1),2),$=J[0],j=J[1],K=(0,i.CR)((0,s.useState)(!1),2),X=K[0],ee=K[1],te=(0,i.CR)((0,s.useState)(h.g.UPDATING),2),ne=te[0],ie=te[1],re=(0,i.CR)((0,s.useState)(!1),2),oe=re[0],se=re[1],ae=(0,i.CR)((0,s.useState)([]),2),ce=ae[0],le=ae[1],ue=(0,i.CR)((0,s.useState)(!0),2),fe=ue[0],pe=ue[1],ge=function(){return new Promise((function(e){j(!0),q(v.lB),ie(h.g.DEPLOYING),(0,c.aw)(x.id).then((function(){ee(!0),se(!1),q(v.$M),ie(h.g.DEPLOYED)})).catch((function(e){se(!0),ie(h.g.DEPLOYING_ERROR),(0,k.Eo)(e||R.Z["api-error-messages"]["deploy-ingestion-error"])})).finally((function(){return e()}))}))},me=function(){return new Promise((function(e,t){(0,c.x1)().then((function(n){200===n.status?e():t()})).catch((function(){return t()}))}))},de=function(){T.push((0,v.LE)(P,N,"ingestions"))};return(0,s.useEffect)((function(){le([{name:(0,o.startCase)(N),url:(0,Z.si)(w.CZ.SERVICES,(0,I.tJ)(N))},{name:(null==L?void 0:L.name)||"",url:(0,v.LE)(P,N,"ingestions"),imgSrc:(0,I.zF)((null==L?void 0:L.serviceType)||""),activeTitle:!0},{name:(0,D.Q)(n,E.Rw.EDIT),url:"",activeTitle:!0}])}),[N,n,L]),(0,s.useEffect)((function(){n===S.Hz.Dbt&&F(2)}),[n]),(0,s.useEffect)((function(){new Promise((function(e){me().then((function(){pe(!0)})).catch((function(){pe(!1)})).finally((function(){return e()}))})).finally((function(){var e;e=[new Promise((function(e,t){(0,l.dO)(N,P).then((function(t){t?(A(t),e()):(0,k.Eo)(R.Z["api-error-messages"]["fetch-service-error"])})).catch((function(e){var n;if(404===(null===(n=e.response)||void 0===n?void 0:n.status))M((0,y.mW)(N,P));else{var i=R.Z["api-error-messages"]["fetch-service-error"];(0,k.Eo)(e,i),M(i)}t()}))})),new Promise((function(e,n){(0,c.ne)(t,["pipelineStatuses"]).then((function(t){if(!t)throw R.Z["api-error-messages"]["unexpected-server-response"];z(t),e()})).catch((function(e){var i;if(404===(null===(i=e.response)||void 0===i?void 0:i.status))M((0,y.mW)("Ingestion",t));else{var r=R.Z["api-error-messages"]["fetch-ingestion-error"];(0,k.Eo)(e,r),M(r)}n()}))}))],Promise.allSettled(e).finally((function(){return U(!1)}))}))}),[N,P]),s.createElement(g.Z,null,H?s.createElement(d.Z,null):B?s.createElement(f.Z,null,B):s.createElement("div",{className:"self-center"},s.createElement(m.Z,{center:!0},s.createElement(r.Z,{direction:"vertical",size:"middle"},s.createElement(p.Z,{titleLinks:ce}),s.createElement("div",{className:"form-container"},s.createElement(u.Z,{activeIngestionStep:Y,data:x,handleCancelClick:de,handleViewServiceClick:de,heading:(0,D.Q)(n,E.Rw.EDIT),ingestionAction:ne,ingestionProgress:W,isAirflowSetup:fe,isIngestionCreated:$,isIngestionDeployed:X,pipelineType:n,serviceCategory:N,serviceData:L,setActiveIngestionStep:function(e){return F(e)},showDeployButton:oe,status:C.Y.EDIT,onAirflowStatusCheck:me,onIngestionDeploy:ge,onSuccessSave:de,onUpdateIngestion:function(e){x.deployed||q(v.aN);var t={airflowConfig:e.airflowConfig,description:e.description,displayName:e.displayName,loggerLevel:e.loggerLevel,name:e.name,owner:e.owner,pipelineType:e.pipelineType,service:e.service,sourceConfig:e.sourceConfig};return new Promise((function(e,n){return(0,c.tr)(t).then((function(t){if(!t)throw R.Z["api-error-messages"]["update-ingestion-error"];ge(),e()})).catch((function(e){(0,k.Eo)(e,R.Z["api-error-messages"]["update-ingestion-error"]),n()}))}))}}))),s.createElement("div",{className:"m-t-xlg p-x-lg w-800","data-testid":"right-panel"},(0,I.qx)(Y,!0,(null==x?void 0:x.name)||"","",n,(n===S.Hz.Metadata?Y>=3:Y>=2)&&!oe,!0,fe)))))}},14731:function(e,t,n){n.d(t,{Q:function(){return s}});var i=n(67800),r=n(78666),o=n(55726),s=function(e,t){var n=(0,i.t)("label."+r.Pm[e]);return e===o.Hz.Dbt&&(n=(0,i.t)("label.dbt-lowercase")),t===r.Rw.ADD?(0,i.t)("label.add-workflow-ingestion",{workflow:n}):(0,i.t)("label.edit-workflow-ingestion",{workflow:n})}}}]);